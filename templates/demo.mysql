-- Creates and populates the scisql_demo database, which:
--   * allows experimentation with the sciSQL spatial UDFs/stored procedures
--   * serves as the execution context when testing the sample queries in
--     the sciSQL documentation.

DROP DATABASE IF EXISTS scisql_demo;
CREATE DATABASE scisql_demo;
USE scisql_demo;

-- Create and populate a subset of the LSST Science CCD Exposure
-- metadata table.

CREATE TABLE Science_Ccd_Exposure (
    scienceCcdExposureId BIGINT           NOT NULL PRIMARY KEY,
    llcRa                DOUBLE PRECISION NOT NULL,
    llcDecl              DOUBLE PRECISION NOT NULL,
    ulcRa                DOUBLE PRECISION NOT NULL,
    ulcDecl              DOUBLE PRECISION NOT NULL,
    urcRa                DOUBLE PRECISION NOT NULL,
    urcDecl              DOUBLE PRECISION NOT NULL,
    lrcRa                DOUBLE PRECISION NOT NULL,
    lrcDecl              DOUBLE PRECISION NOT NULL,
    fluxMag0             FLOAT            NOT NULL,
    fluxMag0Sigma        FLOAT            NOT NULL,
    poly                 BINARY(120)      NOT NULL
) ENGINE=MyISAM;

CREATE TABLE Science_Ccd_Exposure_HtmId10 (
    scienceCcdExposureId BIGINT NOT NULL,
    htmId10 INTEGER NOT NULL,
    PRIMARY KEY (htmId10, scienceCcdExposureId),
    KEY (scienceCcdExposureId)
) ENGINE=MyISAM;

INSERT INTO Science_Ccd_Exposure VALUE (43799463478, 359.860228327377,    0.0613107747415938,   359.950355821899, 0.263884141269675, 0.156577346120423,    0.17213300060837, 0.0664486041079542, -0.0304395996625614, 2.60211e+12, 0, '');
INSERT INTO Science_Ccd_Exposure VALUE (43808367119, 359.956695314663,    0.0909495270369891,  0.158736258074752, 0.182506391403095, 0.251941170740913,  -0.023171937472421, 0.0499004802626148,   -0.11472848235504, 2.26453e+12, 0, '');
INSERT INTO Science_Ccd_Exposure VALUE (43808501263, 359.960732808801,    0.0370516799705218,  0.159612980312648, 0.135231598031079, 0.259560709818247,  -0.067229210773671, 0.0606801487842854,  -0.165409236743199, 2.86155e+12, 0, '');
INSERT INTO Science_Ccd_Exposure VALUE (43856062009, 359.963752800388, -0.000164598414602848, 0.0184876953780186, 0.214756306613358,  0.23727926928965,   0.159035132069238,  0.182543079658319, -0.0558855823940503, 2.37455e+12, 0, '');
INSERT INTO Science_Ccd_Exposure VALUE (43904968207, 359.958110037772,    0.0734879497011048,  0.159109863573049, 0.167182106788634, 0.254490784321818, -0.0374364004155128, 0.0534909527032384,  -0.131130475563235, 4.00006e+12, 0, '');

UPDATE Science_Ccd_Exposure
    SET poly = {{SCISQL_PREFIX}}s2CPolyToBin(
        llcRa, llcDecl,
        ulcRa, ulcDecl,
        urcRa, urcDecl,
        lrcRa, lrcDecl);

INSERT INTO Science_Ccd_Exposure_HtmId10 VALUES
	(43799463478,8388608),
	(43799463478,8388611),
	(43799463478,12058624),
	(43799463478,12582912),
	(43799463478,12582913),
	(43799463478,12582914),
	(43799463478,12582915),
	(43799463478,12582916),
	(43799463478,12582917),
	(43799463478,12582918),
	(43799463478,12582919),
	(43799463478,12582924),
	(43799463478,12582925),
	(43799463478,12582926),
	(43799463478,12582927),
	(43799463478,16252928),
	(43799463478,16252929),
	(43799463478,16252930),
	(43799463478,16252931),
	(43799463478,16252937),
	(43799463478,16252938),
	(43799463478,16252939),
	(43799463478,16252940),
	(43799463478,16252941),
	(43799463478,16252942),
	(43799463478,16252943);
INSERT INTO Science_Ccd_Exposure_HtmId10 VALUES
	(43808367119,8388608),
	(43808367119,8388609),
	(43808367119,8388610),
	(43808367119,8388611),
	(43808367119,8388617),
	(43808367119,8388619),
	(43808367119,8388621),
	(43808367119,8388622),
	(43808367119,8388623),
	(43808367119,12058624),
	(43808367119,12582912),
	(43808367119,12582913),
	(43808367119,12582915),
	(43808367119,16252928),
	(43808367119,16252929),
	(43808367119,16252930),
	(43808367119,16252931),
	(43808367119,16252933),
	(43808367119,16252934),
	(43808367119,16252935),
	(43808367119,16252938),
	(43808367119,16252940),
	(43808367119,16252941),
	(43808367119,16252942),
	(43808367119,16252943);
INSERT INTO Science_Ccd_Exposure_HtmId10 VALUES
	(43808501263,8388608),
	(43808501263,8388609),
	(43808501263,8388610),
	(43808501263,8388611),
	(43808501263,8388617),
	(43808501263,8388618),
	(43808501263,8388619),
	(43808501263,8388620),
	(43808501263,8388621),
	(43808501263,8388622),
	(43808501263,8388623),
	(43808501263,12058624),
	(43808501263,12582912),
	(43808501263,16252928),
	(43808501263,16252929),
	(43808501263,16252930),
	(43808501263,16252931),
	(43808501263,16252933),
	(43808501263,16252934),
	(43808501263,16252935),
	(43808501263,16252940),
	(43808501263,16252941),
	(43808501263,16252942),
	(43808501263,16252943);
INSERT INTO Science_Ccd_Exposure_HtmId10 VALUES
	(43856062009,8388608),
	(43856062009,8388610),
	(43856062009,8388611),
	(43856062009,8388617),
	(43856062009,8388621),
	(43856062009,12058624),
	(43856062009,12582912),
	(43856062009,12582913),
	(43856062009,12582915),
	(43856062009,16252928),
	(43856062009,16252929),
	(43856062009,16252930),
	(43856062009,16252931),
	(43856062009,16252933),
	(43856062009,16252934),
	(43856062009,16252935),
	(43856062009,16252937),
	(43856062009,16252938),
	(43856062009,16252939),
	(43856062009,16252940),
	(43856062009,16252941),
	(43856062009,16252942),
	(43856062009,16252943),
	(43856062009,16252986);
INSERT INTO Science_Ccd_Exposure_HtmId10 VALUES
	(43904968207,8388608),
	(43904968207,8388609),
	(43904968207,8388610),
	(43904968207,8388611),
	(43904968207,8388617),
	(43904968207,8388619),
	(43904968207,8388621),
	(43904968207,8388622),
	(43904968207,8388623),
	(43904968207,12058624),
	(43904968207,12582912),
	(43904968207,12582913),
	(43904968207,12582915),
	(43904968207,16252928),
	(43904968207,16252929),
	(43904968207,16252930),
	(43904968207,16252931),
	(43904968207,16252933),
	(43904968207,16252934),
	(43904968207,16252935),
	(43904968207,16252940),
	(43904968207,16252941),
	(43904968207,16252942),
	(43904968207,16252943);


-- Create and populate a sample LSST Object table.

CREATE TABLE Object (
    objectId       BIGINT           NOT NULL PRIMARY KEY,
    ra_PS          DOUBLE PRECISION NOT NULL,
    decl_PS        DOUBLE PRECISION NOT NULL,
    ra_SG          DOUBLE PRECISION NOT NULL,
    decl_SG        DOUBLE PRECISION NOT NULL,
    rFlux_PS       FLOAT,
    rFlux_PS_Sigma FLOAT,
    htmId20        BIGINT           NOT NULL
) ENGINE=MyISAM;

INSERT INTO Object VALUE (414764991783299,  0.00178866914963,  -0.00924094376097,  0.00179610535526,  -0.00924637729381,  7.2716e-29,    3.76618e-29, 0);
INSERT INTO Object VALUE (414760696821231,     359.999948817,   -0.0090766767207,     359.999968618,   -0.0090850236226,        NULL,           NULL, 0);
INSERT INTO Object VALUE (414764991783300,  0.00234941521223,  -0.00861594175384,  0.00234308834712,  -0.00858872706016, 2.04827e-29,    1.55289e-30, 0);
INSERT INTO Object VALUE (414760696821225,     359.990674586,  -0.00822004925575,     359.990706936,  -0.00819989609437, 1.30442e-28,    2.28693e-29, 0);
INSERT INTO Object VALUE (414760696821229,     359.993175485,  -0.00783197919369,     359.993193705,   -0.0078299540538, 2.01377e-29,    3.26033e-30, 0);
INSERT INTO Object VALUE (414764991783302,  0.00254302688922,  -0.00776147835068,  0.00255564126452,  -0.00775942576395, 1.23287e-29,     1.3048e-30, 0);
INSERT INTO Object VALUE (414764991783301,  0.00249810717852,  -0.00358600677427,  0.00249551916706,  -0.00364627989356,  1.6323e-29,    1.83538e-30, 0);
INSERT INTO Object VALUE (414760696821232,     359.993162783,  -0.00137413435836,     359.993185316,  -0.00136560590081, 1.25378e-28,    2.41636e-29, 0);
INSERT INTO Object VALUE (414760696821233,     359.992043388, -0.000408477354549,     359.992057131, -0.000406786706474, 1.32532e-28,    2.47353e-29, 0);
INSERT INTO Object VALUE (414760696821234,     359.998773606,  -0.00026149039812,     359.998776528, -0.000258741868499, 1.39502e-28,    2.51457e-29, 0);
INSERT INTO Object VALUE (414764991783303,  0.00946776780497, -0.000204835095337,  0.00946715446244, -0.000188192006066, 9.86258e-30,    1.08303e-30, 0);
INSERT INTO Object VALUE (417857368227844,  0.00831403041321,  0.000380993263554,  0.00830119341063,   0.00039676689616, 8.41228e-29,    6.21798e-30, 0);
INSERT INTO Object VALUE (417857368227840, 0.000498453339199,   0.00197407242761,  0.00051837618892,     0.001991254379, 4.46942e-29,    6.02666e-30, 0);
INSERT INTO Object VALUE (417853073264246,     359.995965307,    0.0023329464117,     359.996001312,   0.00233957980802, 4.76943e-29,    7.55407e-30, 0);
INSERT INTO Object VALUE (417857368227842,  0.00643243749716,   0.00251578805432,  0.00643713925054,   0.00251123398468, 2.24867e-29,     3.2548e-30, 0);
INSERT INTO Object VALUE (417857368227843,   0.0065038046588,   0.00369407309401,  0.00653683675527,   0.00369959177679, 1.79485e-29,    1.72885e-30, 0);
INSERT INTO Object VALUE (417857368227841, 0.000473833210474,   0.00421220527864, 0.000446411377093,   0.00419438850588, 2.83493e-29,    2.18595e-30, 0);
INSERT INTO Object VALUE (417857368227846,  0.00916580310985,   0.00510753736299,  0.00918847285765,   0.00510517918597, 3.58285e-29,    2.62149e-30, 0);
INSERT INTO Object VALUE (417853073264245,     359.994434059,   0.00740888856151,     359.994440975,   0.00744711923394,  3.2958e-29,    3.85351e-30, 0);

UPDATE Object SET htmId20 = {{SCISQL_PREFIX}}s2HtmId(ra_PS, decl_PS, 20);
ALTER TABLE Object ADD KEY (htmId20);


-- Create and populate a sample LSST Source table.

CREATE TABLE Source (
    sourceId             BIGINT           NOT NULL PRIMARY KEY,
    scienceCcdExposureId BIGINT           NOT NULL,
    objectId             BIGINT,
    ra                   DOUBLE PRECISION NOT NULL,
    decl                 DOUBLE PRECISION NOT NULL,
    psfFlux              FLOAT            NOT NULL,
    psfFluxSigma         FLOAT            NOT NULL,
    htmId20              BIGINT           NOT NULL
) ENGINE=MyISAM;

INSERT INTO Source VALUE (2871033938772031, 43808501263, 414760696821225,     359.990596006,  -0.00824773313986, 14576.0585821, 610.448, 0);
INSERT INTO Source VALUE (2874153563982875, 43856102966, 414760696821225,     359.990679575,  -0.00835097609265, 8163.22439199, 149.979, 0);
INSERT INTO Source VALUE (2871033938772058, 43808501263, 414760696821229,     359.993103852,  -0.00780668089754, 1795.68533623, 293.501, 0);
INSERT INTO Source VALUE (2874153563982896, 43856102966, 414760696821229,     359.993179179,  -0.00795480011889, 1273.53131424, 98.9836, 0);
INSERT INTO Source VALUE (2871033938772078, 43808501263, 414760696821232,     359.993081411,  -0.00140006327705, 12508.2963102, 545.696, 0);
INSERT INTO Source VALUE (2874150879821891, 43856062009, 414760696821232,      359.99307309,  -0.00132078906667, 7970.57172297, 177.051, 0);
INSERT INTO Source VALUE (2871033938772073, 43808501263, 414760696821233,     359.991959754, -0.000437387665425,  13097.900455,  563.14, 0);
INSERT INTO Source VALUE (2874150879821897, 43856062009, 414760696821233,     359.991950173, -0.000357767294996, 8443.03518648, 179.978, 0);
INSERT INTO Source VALUE (2871033938772120, 43808501263, 414760696821234,     359.998715774, -0.000275265713218, 15156.9801481, 624.132, 0);
INSERT INTO Source VALUE (2874150879821915, 43856062009, 414760696821234,     359.998691848, -0.000199074141903, 8791.61761221, 179.608, 0);
INSERT INTO Source VALUE (2877355996414000, 43904968207, 414760696821234,     359.998701149, -0.000269228512215, 26798.6663644, 2180.03, 0);
INSERT INTO Source VALUE (2871033938772111, 43808501263, 414764991783299,  0.00166566638638,   -0.0092942787328, 5915.52283493,  359.01, 0);
INSERT INTO Source VALUE (2877355996413990, 43904968207, 414764991783299,   0.0018366682138,  -0.00917395870949, 6991.15994905, 714.258, 0);
INSERT INTO Source VALUE (2874150879821841, 43856062009, 414764991783300,  0.00226258434196,  -0.00856372717231, 1339.61364849, 140.227, 0);
INSERT INTO Source VALUE (2871025147510813, 43808367119, 414764991783301,  0.00243582301171,  -0.00358534529673, 932.125808655, 99.2698, 0);
INSERT INTO Source VALUE (2871033938772135, 43808501263, 414764991783301,  0.00234271241319,  -0.00347586535767, 1235.51499382, 280.932, 0);
INSERT INTO Source VALUE (2874150879821893, 43856062009, 414764991783301,  0.00245325237348,  -0.00357345378518, 1257.24419938, 139.963, 0);
INSERT INTO Source VALUE (2871025147510796, 43808367119, 414764991783302,  0.00252744853613,  -0.00779493931252, 716.608785042, 98.2046, 0);
INSERT INTO Source VALUE (2874150879821847, 43856062009, 414764991783302,  0.00253254747944,  -0.00775093986071, 915.248019103, 138.332, 0);
INSERT INTO Source VALUE (2870441638494255, 43799463478, 414764991783303,  0.00950641041254, -3.91815190745e-05, 782.551786048, 135.552, 0);
INSERT INTO Source VALUE (2871025147510910, 43808367119, 414764991783303,  0.00940591415663, -0.000297944199855, 694.987062716, 97.4382, 0);
INSERT INTO Source VALUE (2874153564176390, 43856102969, 414764991783303,  0.00945654668714, -0.000145957803792, 543.876068413, 83.0277, 0);
INSERT INTO Source VALUE (2870441638494263, 43799463478, 417853073264245,     359.994465074,   0.00753743371232, 2616.39931456, 175.131, 0);
INSERT INTO Source VALUE (2871033938772117, 43808501263, 417853073264245,     359.994365585,   0.00738605802892, 3276.53200017, 309.096, 0);
INSERT INTO Source VALUE (2874150879821994, 43856062009, 417853073264245,      359.99432378,   0.00748304619655, 2308.69845991, 146.258, 0);
INSERT INTO Source VALUE (2874153564176432, 43856102969, 417853073264245,     359.994359172,   0.00749146449596, 1936.84036962, 91.8865, 0);
INSERT INTO Source VALUE (2877355996413995, 43904968207, 417853073264245,     359.994405516,   0.00719073609074, 3281.99609635, 503.268, 0);
INSERT INTO Source VALUE (2870441638494223, 43799463478, 417853073264246,     359.995990591,   0.00245230110267, 3460.35841353, 200.171, 0);
INSERT INTO Source VALUE (2871033938772110, 43808501263, 417853073264246,     359.995895846,   0.00230526212482, 4320.24774591, 328.346, 0);
INSERT INTO Source VALUE (2874150879821943, 43856062009, 417853073264246,     359.995878412,   0.00237389810056, 3014.56733667,  149.67, 0);
INSERT INTO Source VALUE (2877355996413986, 43904968207, 417853073264246,     359.995897982,   0.00228186123967, 4906.14974714, 585.493, 0);
INSERT INTO Source VALUE (2870441638494237, 43799463478, 417857368227840, 0.000567548046155,   0.00210223497978, 3757.20823511, 206.858, 0);
INSERT INTO Source VALUE (2874150879821951, 43856062009, 417857368227840, 0.000452354265555,   0.00199480503217, 3208.68257919, 149.821, 0);
INSERT INTO Source VALUE (2874153564176385, 43856102969, 417857368227840, 0.000451836535566,    0.0020358809003, 2595.98210079, 96.0304, 0);
INSERT INTO Source VALUE (2877355996414017, 43904968207, 417857368227840, 0.000446337661802,   0.00198222738082, 9104.74125763, 847.528, 0);
INSERT INTO Source VALUE (2870441638494257, 43799463478, 417857368227841, 0.000503641400739,   0.00431709580482, 2532.59235957, 172.132, 0);
INSERT INTO Source VALUE (2871025147510833, 43808367119, 417857368227841, 0.000397255018007,   0.00419463041891, 1823.54291232, 106.711, 0);
INSERT INTO Source VALUE (2871033938772146, 43808501263, 417857368227841, 0.000633542373756,   0.00423989282682, 1851.54784963, 285.572, 0);
INSERT INTO Source VALUE (2874150879821975, 43856062009, 417857368227841, 0.000387658705119,   0.00424048694769, 1854.88629006, 143.424, 0);
INSERT INTO Source VALUE (2874153564176414, 43856102969, 417857368227841, 0.000415535243087,   0.00426243277333, 1674.59349191, 90.0132, 0);
INSERT INTO Source VALUE (2870441638494269, 43799463478, 417857368227842,  0.00650463037717,   0.00261818229364, 2083.02806067, 160.298, 0);
INSERT INTO Source VALUE (2871025147510881, 43808367119, 417857368227842,  0.00635663537335,    0.0024746915605, 1470.00141687, 103.232, 0);
INSERT INTO Source VALUE (2871033938772188, 43808501263, 417857368227842,  0.00636316114601,   0.00250001900608, 2684.39779131, 294.685, 0);
INSERT INTO Source VALUE (2874153564176411, 43856102969, 417857368227842,  0.00637160311747,   0.00256907001888,  1198.5973386, 86.5154, 0);
INSERT INTO Source VALUE (2870441638494285, 43799463478, 417857368227843,  0.00656959833868,   0.00383764208825, 1270.40423318, 143.956, 0);
INSERT INTO Source VALUE (2871025147510902, 43808367119, 417857368227843,  0.00647266185411,   0.00368176376722, 989.598090861, 100.269, 0);
INSERT INTO Source VALUE (2874150879821987, 43856062009, 417857368227843,  0.00645019588944,   0.00374896067581, 1358.20003248, 141.903, 0);
INSERT INTO Source VALUE (2874153564176427, 43856102969, 417857368227843,  0.00646589238967,    0.0037706167461, 1169.73464866, 88.1191, 0);
INSERT INTO Source VALUE (2877355996414080, 43904968207, 417857368227843,  0.00636902843503,   0.00376165547594,  2598.4859919, 476.452, 0);
INSERT INTO Source VALUE (2870441638494250, 43799463478, 417857368227844,  0.00835999189521,   0.00051072608745, 6370.46887331, 295.413, 0);
INSERT INTO Source VALUE (2871025147510903, 43808367119, 417857368227844,   0.0082661074865,  0.000376105596882, 5183.95747168, 143.832, 0);
INSERT INTO Source VALUE (2871033938772201, 43808501263, 417857368227844,  0.00826786834325,  0.000354366275521, 8120.58504788, 411.543, 0);
INSERT INTO Source VALUE (2874150879821952, 43856062009, 417857368227844,  0.00825564664538,  0.000422572153221, 5653.03331821, 163.662, 0);
INSERT INTO Source VALUE (2874153564176392, 43856102969, 417857368227844,   0.0082583305903,  0.000449563866619, 5170.19286513, 114.269, 0);
INSERT INTO Source VALUE (2877355996414081, 43904968207, 417857368227844,  0.00830339303834,  0.000347378466109, 12295.1368759, 1077.52, 0);
INSERT INTO Source VALUE (2870441638494306, 43799463478, 417857368227846,  0.00924369864509,   0.00521511158758, 2809.79445321, 179.578, 0);
INSERT INTO Source VALUE (2871025147510938, 43808367119, 417857368227846,  0.00912682153917,   0.00507941229363, 2206.08379113,  109.99, 0);
INSERT INTO Source VALUE (2874150879822011, 43856062009, 417857368227846,  0.00913533923973,   0.00514742065437, 2642.40076587, 148.013, 0);
INSERT INTO Source VALUE (2874153564176452, 43856102969, 417857368227846,  0.00912898135467,   0.00516346633239, 2128.63806458,  93.647, 0);

UPDATE Source SET htmId20 = {{SCISQL_PREFIX}}s2HtmId(ra, decl, 20);
ALTER TABLE Source ADD KEY (htmId20);

